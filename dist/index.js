!function(t){var e={};function s(a){if(e[a])return e[a].exports;var i=e[a]={i:a,l:!1,exports:{}};return t[a].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=t,s.c=e,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(a,i,function(e){return t[e]}.bind(null,i));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=1)}([,function(t,e,s){"use strict";s.r(e);new class{constructor(t,e,s){this.backdrop=document.getElementById(t),this.frontLayer=document.getElementById(e),this.menuButton=document.getElementById(s)}register(){this.registerButtonEvent(),this.registerFrontLayerEvent()}registerButtonEvent(){this.menuButton.addEventListener("click",()=>{this.backdrop.classList.contains("hidden")?this.backdrop.classList.remove("hidden"):this.backdrop.classList.add("hidden"),this.menuButton.classList.contains("open")?this.menuButton.classList.remove("open"):this.menuButton.classList.add("open")})}registerFrontLayerEvent(){this.frontLayer.addEventListener("click",()=>{this.backdrop.classList.add("hidden"),this.menuButton.classList.remove("open")})}}("menu","front-layer","show-menu").register();let a=new class{constructor(t){this.multiSelects=document.getElementsByClassName(t)}register(){for(let t of this.multiSelects)this.selected||(this.selected=t.id),t.addEventListener("click",t=>{if(!t.target.disabled){for(let t of this.multiSelects)t.classList.remove("selected");t.target.classList.add("selected"),this.selected=t.target.id}})}getSelection(){return this.selected}}("multi-item");a.register();let i=new class{constructor(t,e,s){this.banner=document.getElementById(t),this.bannerText=document.getElementById(e),this.dismissBtn=document.getElementById(s),this.banner.style.removeProperty("display")}register(){this.dismissBtn.addEventListener("click",()=>{this.banner.classList.add("hidden")})}show(t){this.banner.classList.remove("hidden"),this.bannerText.innerText=t}hide(){this.banner.classList.add("hidden")}}("notifications","banner-info","dismiss-banner");i.register(),window.uiManager=new class{constructor(...t){this.uiElements=[];for(let e of t)"string"==typeof e&&this.uiElements.push(...document.getElementsByClassName(e))}disable(){for(let t of this.uiElements)t.classList.add("disabled"),t.disabled=!0}enable(){for(let t of this.uiElements)t.classList.remove("disabled"),t.disabled=!1}}("multi-item","file-input","file-options","submit-btn","upload-text");let r=new class{constructor(t,e){this.dataLoaded=!1;let s=new XMLHttpRequest;s.addEventListener("load",t=>{this.data=t.target.response,this.dataLoaded=!0,console.log("Data for decoder loaded.")}),s.open("GET",t),s.responseType="json",s.send(),this.game=e}setGame(t){this.game=t}decodeText(t,e=0){if(!this.dataLoaded){let s=e*e*20;return console.log("Decoder not ready, retrying in:",s.toString()+"ms"),window.setTimeout(this.decodeText.bind(this,t,e+1),s),-1}let s=this.data[this.game]["text-encoding"],a="";for(let e of t)a+=s[e];return a}}("./ressources/encoding.json","redBlue");new class{constructor(t,e,s,a,i){this.fileInput=document.getElementById(t),this.submitBtn=document.getElementById(e),this.btnLabel=document.getElementById(s),this.notifications=a,this.uiManager=i}extractData(t){this.uiManager.disable();let e=this.fileInput.files;if(e.length<1)return this.notifications.show("No file received."),this.uiManager.enable(),1;let s=e[0];if(s.size>104857600)return this.notifications.show("File size cannot exceed 100MB."),this.uiManager.enable(),2;let a=new FileReader;return a.readAsArrayBuffer(s),a.addEventListener("load",()=>{let e=new Uint8Array(a.result);t(e)}),this.notifications.hide(),a}register(t=function(){}){let e,s=this.fileInput.files;e=s.length>0?s[0].name:"Upload ROM-File",this.btnLabel.innerText=e,this.fileInput.addEventListener("change",()=>{let t,e=this.fileInput.files;t=e.length>0?e[0].name:"Upload ROM-File",this.btnLabel.innerText=t}),this.submitBtn.addEventListener("click",()=>{this.extractData(t)})}}("rom-select","submit-btn","upload-label",i,uiManager).register(t=>{let e,s=a.getSelection();switch(r.setGame(s),s){case"redBlue":e=new class{constructor(t,e){this.rawData=t,this.decoder=e,this.processedData={}}extract(){this.getRomName(),this.getMapHeaders(this.getMapHeaderAddresses()),this.getMapData(),this.getMapObjectData(),this.debug()}debug(){console.log(this.processedData)}getPointer(t,e){return parseInt(e.toString(16)+t.toString(16),16)%16384}getRomName(){this.processedData.romName=String.fromCharCode(...this.rawData.slice(308,324)).replace(/\0/g,"")}getMapHeaderAddresses(){const t=Array.from(this.rawData.slice(49725,49973)).map(t=>16384*t),e=this.rawData.slice(430,926);let s=[],a=[];for(let t=0;t<e.length;t+=2)s.push(this.getPointer(e[t],e[t+1]));for(let e=0;e<s.length;e++)a.push(t[e]+s[e]);return a}getMapHeaders(t){this.processedData.map=[];for(let e of t){let t={memoryBank:Math.floor(e/16384),tilesetId:this.rawData[e],height:this.rawData[e+1],width:this.rawData[e+2],connection:null,connections:{},pointers:{mapData:this.getPointer(this.rawData[e+3],this.rawData[e+4]),textPointers:this.getPointer(this.rawData[e+5],this.rawData[e+6]),script:this.getPointer(this.rawData[e+7],this.rawData[e+8])}},s=9;t.connection=this.rawData[e+s++];for(let a=3;a>=0;a--){let i="";switch(a){case 3:i="north";break;case 2:i="south";break;case 1:i="west";break;case 0:i="east"}t.connection&1<<a&&(t.connections[i]={mapId:this.rawData[e+s++],pointers:{connectBlock:this.getPointer(this.rawData[e+s++],this.rawData[e+s++]),currentBlock:this.getPointer(this.rawData[e+s++],this.rawData[e+s++])},biggness:this.rawData[e+s++],mapWidth:this.rawData[e+s++],yPos:this.rawData[e+s++],xPos:this.rawData[e+s++],window:256*this.rawData[e+s++]+this.rawData[e+s++]})}t.pointers.objectData=this.getPointer(this.rawData[e+s++],this.rawData[e+s++]),this.processedData.map.push(t)}}getMapData(){for(let t of this.processedData.map){const e=t.pointers.mapData,s=16384*t.memoryBank+e,a=t.width,i=t.height;let r=[];for(let t=0;t<i;t++){r[t]=[];for(let e=0;e<a;e++){const i=t*a+e;r[t][e]=this.rawData[s+i]}}t.tiles=r}}getMapObjectData(){for(let t of this.processedData.map){const e=t.pointers.objectData,s=16384*t.memoryBank+e;let a=0,i={};i.borderBlock=this.rawData[s+a++],i.numWarps=this.rawData[s+a++],i.warps=[];for(let t=0;t<i.numWarps;t++)i.warps.push({xPos:this.rawData[s+a++],yPos:this.rawData[s+a++],warpInId:this.rawData[s+a++],destMap:this.rawData[s+a++]});i.numSigns=this.rawData[s+a++],i.signs=[];for(let t=0;t<i.numSigns;t++)i.signs.push({xPos:this.rawData[s+a++],yPos:this.rawData[s+a++],textId:this.rawData[s+a++]});i.numNPCs=this.rawData[s+a++],i.npcs=[];for(let t=0;t<i.numNPCs;t++){let t={picId:this.rawData[s+a++],xPos:this.rawData[s+a++],yPos:this.rawData[s+a++],mov1:this.rawData[s+a++],mov2:this.rawData[s+a++],textId:this.rawData[s+a++]};if(128&t.textId)t.type="item",t.itemId=this.rawData[s+a++];else if(64&t.textId){let e=this.rawData[s+a++],i=this.rawData[s+a++];e<200?(t.type="pkmnStatic",t.trainerClass=e,t.rosterId=i):(t.type="trainer",t.trainerClass=e,t.rosterId=i)}i.npcs.push(t)}i.warpIns=[];for(let t=0;t<i.numWarps;t++)i.warpIns.push({windowPointer:this.getPointer(this.rawData[s+a++],this.rawData[s+a++]),yPos:this.rawData[s+a++],xPos:this.rawData[s+a++]});t.objectData=i}}}(t,r);break;default:return 1}e.extract(),uiManager.enable()})}]);