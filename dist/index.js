!function(t){var e={};function a(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=t,a.c=e,a.d=function(t,e,s){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)a.d(s,r,function(e){return t[e]}.bind(null,r));return s},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=1)}([,function(t,e,a){"use strict";a.r(e);var s={getPointer:function(t,e){return(256*e+t)%16384}};class r{constructor(t){this.rawData=t}extractMaps(t){let e=this.getMapHeaders(this.getMapHeaderAddresses(t.pointerPointers.map.headers));return this.getMapData(e),this.getMapObjectData(e),e}getMapHeaderAddresses(t){const e=Array.from(this.rawData.slice(t.banks.from,t.banks.to)).map(t=>16384*t),a=this.rawData.slice(t.pointers.from,t.pointers.to);let r=[],i=[];for(let t=0;t<a.length;t+=2)r.push(s.getPointer(a[t],a[t+1]));for(let t=0;t<r.length;t++)i.push(e[t]+r[t]);return i}getMapHeaders(t){let e=[];for(let a of t){let t={memoryBank:Math.floor(a/16384),tilesetId:this.rawData[a],height:this.rawData[a+1],width:this.rawData[a+2],connection:null,connections:{},pointers:{mapData:s.getPointer(this.rawData[a+3],this.rawData[a+4]),textPointers:s.getPointer(this.rawData[a+5],this.rawData[a+6]),script:s.getPointer(this.rawData[a+7],this.rawData[a+8])}},r=9;t.connection=this.rawData[a+r++];for(let e=3;e>=0;e--){let i="";switch(e){case 3:i="north";break;case 2:i="south";break;case 1:i="west";break;case 0:i="east"}t.connection&1<<e&&(t.connections[i]={mapId:this.rawData[a+r++],pointers:{connectBlock:s.getPointer(this.rawData[a+r++],this.rawData[a+r++]),currentBlock:s.getPointer(this.rawData[a+r++],this.rawData[a+r++])},biggness:this.rawData[a+r++],mapWidth:this.rawData[a+r++],yPos:this.rawData[a+r++],xPos:this.rawData[a+r++],window:256*this.rawData[a+r++]+this.rawData[a+r++]})}t.pointers.objectData=s.getPointer(this.rawData[a+r++],this.rawData[a+r++]),e.push(t)}return e}getMapData(t){for(let e of t){const t=e.pointers.mapData,a=16384*e.memoryBank+t,s=e.width,r=e.height;let i=[];for(let t=0;t<r;t++){i[t]=[];for(let e=0;e<s;e++){const r=t*s+e;i[t][e]=this.rawData[a+r]}}e.tiles=i}}getMapObjectData(t){for(let e of t){const t=e.pointers.objectData,a=16384*e.memoryBank+t;let r=0,i={};i.borderBlock=this.rawData[a+r++],i.numWarps=this.rawData[a+r++],i.warps=[];for(let t=0;t<i.numWarps;t++)i.warps.push({xPos:this.rawData[a+r++],yPos:this.rawData[a+r++],warpInId:this.rawData[a+r++],destMap:this.rawData[a+r++]});i.numSigns=this.rawData[a+r++],i.signs=[];for(let t=0;t<i.numSigns;t++)i.signs.push({xPos:this.rawData[a+r++],yPos:this.rawData[a+r++],textId:this.rawData[a+r++]});i.numNPCs=this.rawData[a+r++],i.npcs=[];for(let t=0;t<i.numNPCs;t++){let t={picId:this.rawData[a+r++],xPos:this.rawData[a+r++],yPos:this.rawData[a+r++],mov1:this.rawData[a+r++],mov2:this.rawData[a+r++],typeFlag:192&this.rawData[a+r],textId:63&this.rawData[a+r++]};if(64&t.typeFlag){let e=this.rawData[a+r++],s=this.rawData[a+r++];e<200?(t.type="pkmnStatic",t.trainerClass=e,t.rosterId=s):(t.type="trainer",t.trainerClass=e-200,t.rosterId=s)}else 128&t.typeFlag?(t.type="item",t.itemId=this.rawData[a+r++]):t.type="person";i.npcs.push(t)}i.warpIns=[];for(let t=0;t<i.numWarps;t++)i.warpIns.push({windowPointer:s.getPointer(this.rawData[a+r++],this.rawData[a+r++]),yPos:this.rawData[a+r++],xPos:this.rawData[a+r++]});e.objectData=i}}}class i{constructor(t,e){this.rawData=t,this.decoder=e}extractPkmnData(t){return this.getPokemonStatAddresses(t.pointerPointers.pkmnData.stats)}getPokemonStatAddresses(t){const e=this.rawData[t.bank],a=this.rawData[t.mewBank];return[16384*e+s.getPointer(this.rawData[t.pointer],this.rawData[t.pointer+1]),16384*a+s.getPointer(this.rawData[t.mewPointer],this.rawData[t.mewPointer+1])]}getPokemonNameAddresses(){}}class n{constructor(t){this.rawData=t}extractGraphics(t){return null}}class o{constructor(t){this.rawData=t}extractShopData(t){const e=t.concretePointers.shop.from;let a=0,s=[];for(;80!=this.rawData[e+a];){let t={items:[]};for(;255!=this.rawData[e+a];)254==this.rawData[e+a]?(a++,t.itemAmt=this.rawData[e+a++]):t.items.push(this.rawData[e+a++]);s.push(t),a++}return s}}class l{constructor(t,e){this.rawData=t,this.decoder=e}extractText(t){let e={};return e.pkmnNames=this.extractPkmnNames(t),e}extractPkmnNames(t){const e=t.pointerPointers.text.pkmnNames.pointerPos,a=s.getPointer(this.rawData[e],this.rawData[e+1]),r=t.concretePointers.text.pkmnNames.bank,i=t.concretePointers.text.pkmnNames.numPkmn,n=16384*r+a;let o=[null];for(let t=0;t<i;t++)o.push(this.decoder.decodeText(this.rawData.slice(n+10*t,n+10*t+10)).replace(/{end}/g,""));return o}}var h={redBlue:{pointerPointers:{map:{headers:{banks:{from:49725,to:49973},pointers:{from:430,to:926}}},pkmnData:{stats:{bank:5435,mewBank:5532,pointer:5496,mewPointer:5523}},text:{pkmnNames:{pointerPos:12206}}},concretePointers:{basic:{romName:{from:308,to:324},ctrlText:{from:6741}},shop:{from:9282},text:{pkmnNames:{bank:7,numPkmn:190}}}}};let c=new class{constructor(t,e,a){this.backdrop=document.getElementById(t),this.frontLayer=document.getElementById(e),this.menuButton=document.getElementById(a)}register(){this.registerButtonEvent(),this.registerFrontLayerEvent()}registerButtonEvent(){this.menuButton.addEventListener("click",()=>{this.backdrop.classList.contains("hidden")?this.backdrop.classList.remove("hidden"):this.backdrop.classList.add("hidden"),this.menuButton.classList.contains("open")?this.menuButton.classList.remove("open"):this.menuButton.classList.add("open")})}registerFrontLayerEvent(){this.frontLayer.addEventListener("click",()=>{this.backdrop.classList.add("hidden"),this.menuButton.classList.remove("open")})}}("menu","front-layer","show-menu"),d=new class{constructor(t){this.multiSelects=document.getElementsByClassName(t)}register(){for(let t of this.multiSelects)this.selected||(this.selected=t.id),t.addEventListener("click",t=>{if(!t.target.disabled){for(let t of this.multiSelects)t.classList.remove("selected");t.target.classList.add("selected"),this.selected=t.target.id}})}getSelection(){return this.selected}}("multi-item"),m=new class{constructor(t,e,a){this.banner=document.getElementById(t),this.bannerText=document.getElementById(e),this.dismissBtn=document.getElementById(a),this.banner.style.removeProperty("display")}register(){this.dismissBtn.addEventListener("click",()=>{this.banner.classList.add("hidden")})}show(t){this.banner.classList.remove("hidden"),this.bannerText.innerText=t}hide(){this.banner.classList.add("hidden")}}("notifications","banner-info","dismiss-banner"),u=new class{constructor(...t){this.uiElements=[];for(let e of t)"string"==typeof e&&this.uiElements.push(...document.getElementsByClassName(e))}disable(){for(let t of this.uiElements)t.classList.add("disabled"),t.disabled=!0}enable(){for(let t of this.uiElements)t.classList.remove("disabled"),t.disabled=!1}}("multi-item","file-input","file-options","submit-btn","upload-text");c.register(),d.register(),m.register();let p=new class{constructor(t,e,a,s){a.disable(),s.show("Initializing Decoder..."),this.dataLoaded=!1;let r=new XMLHttpRequest;r.addEventListener("load",t=>{this.data=t.target.response,this.dataLoaded=!0,a.enable(),s.hide()}),r.open("GET",t),r.responseType="json",r.send(),this.game=e}setGame(t){this.game=t}decodeText(t){let e=this.data[this.game]["text-encoding"],a="";for(let s of t)a+=e[s];return a}registerControlChars(t){let e=this.data[this.game]["text-encoding"];for(let a of t)e.includes(a.original)&&(e[e.indexOf(a.original)]=this.decodeText(a.new))}}("./ressources/encoding.json","redBlue",u,m);new class{constructor(t,e,a,s,r){this.fileInput=document.getElementById(t),this.submitBtn=document.getElementById(e),this.btnLabel=document.getElementById(a),this.notifications=s,this.uiManager=r}extractData(t){this.uiManager.disable();let e=this.fileInput.files;if(e.length<1)return this.notifications.show("No file received."),this.uiManager.enable(),1;let a=e[0];if(a.size>104857600)return this.notifications.show("File size cannot exceed 100MB."),this.uiManager.enable(),2;let s=new FileReader;return s.readAsArrayBuffer(a),s.addEventListener("load",()=>{let e=new Uint8Array(s.result);t(e)}),this.notifications.hide(),s}register(t=function(){}){let e,a=this.fileInput.files;e=a.length>0?a[0].name:"Upload ROM-File",this.btnLabel.innerText=e,this.fileInput.addEventListener("change",()=>{let t,e=this.fileInput.files;t=e.length>0?e[0].name:"Upload ROM-File",this.btnLabel.innerText=t}),this.submitBtn.addEventListener("click",()=>{this.extractData(t)})}}("rom-select","submit-btn","upload-label",m,u).register(t=>{let e,a=d.getSelection();switch(p.setGame(a),a){case"redBlue":e=new class{constructor(t,e){this.rawData=t,this.decoder=e,this.processedData={},this.defPointers=h,this.mapReader=new r(t),this.pkmnReader=new i(t,e),this.gfxReader=new n(t),this.shopReader=new o(t),this.textReader=new l(t,e)}extract(t="redBlue",e=null){let a={};"redBlue"==t?a=this.defPointers.redBlue:"yellow"==t&&(a=this.defPointers.yellow),null!=e&&(a=Object.assign(a,e)),this.decoder.setGame(t),this.getRomName(a.concretePointers.basic.romName),this.getControlText(a.concretePointers.basic.ctrlText),this.processedData.map=this.mapReader.extractMaps(a),this.processedData.pokemon=this.pkmnReader.extractPkmnData(a),this.processedData.shops=this.shopReader.extractShopData(a),this.processedData.text=this.textReader.extractText(a),this.debug()}debug(){console.log(this.processedData)}getRomName(t){this.processedData.romName=String.fromCharCode(...this.rawData.slice(t.from,t.to)).replace(/\0/g,"")}getControlText(t){const e=t.from;let a=0,s=[],r=["{tm}","{trainer}","{pc}","{rocket}","{poke}","{six_dot}","{target}","{pkmn}"];for(let t of r){let r={original:t,new:[]};for(;80!=this.rawData[e+a++];)r.new.push(this.rawData[e+a-1]);s.push(r)}this.decoder.registerControlChars(s)}}(t,p);break;default:return 1}e.extract(),u.enable()})}]);